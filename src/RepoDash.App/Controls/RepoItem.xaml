<UserControl x:Class="RepoDash.App.Controls.RepoItem"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:RepoDash.App.ViewModels"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance vm:RepoItemViewModel}">
  <UserControl.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/RepoDash.App;component/Themes/Colors.xaml"/>
        <ResourceDictionary Source="/RepoDash.App;component/Themes/Styles.xaml"/>
      </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
  </UserControl.Resources>

  <Grid Margin="0,4">
    <Grid.ColumnDefinitions>
      <ColumnDefinition/>
      <ColumnDefinition Width="Auto"/>
    </Grid.ColumnDefinitions>

    <!-- Left: title + tiny branch -->
    <StackPanel>
      <TextBlock>
        <Run Text="{Binding Name}" FontWeight="SemiBold"/>
      </TextBlock>

      <TextBlock FontSize="10" Margin="0,2,0,0">
        <TextBlock.Style>
          <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource BrushTextSubtle}"/>
            <Style.Triggers>
              <DataTrigger Binding="{Binding SyncState}" Value="UpToDate">
                <Setter Property="Foreground" Value="Green"/>
              </DataTrigger>
              <DataTrigger Binding="{Binding SyncState}" Value="Ahead">
                <Setter Property="Foreground" Value="DodgerBlue"/>
              </DataTrigger>
              <DataTrigger Binding="{Binding SyncState}" Value="Behind">
                <Setter Property="Foreground" Value="DarkOrange"/>
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </TextBlock.Style>
        <TextBlock Text="*" Foreground="Red" FontWeight="Black"
                   Visibility="{Binding IsDirty, Converter={StaticResource BooleanToVisibilityConverter}}"
                   FontSize="10" Margin="0" Padding="0"/>
        <Run Text="{Binding CurrentBranch}"/>
      </TextBlock>
    </StackPanel>
    <UniformGrid Grid.Column="1" HorizontalAlignment="Right"  Rows="2">
      <Button Style="{StaticResource IconFlatButton}" Command="{Binding LaunchCommand}" ToolTip="Launch" Margin="0,0,4,0">
        <TextBlock Text="▶"/>
      </Button>
      <Button Style="{StaticResource IconFlatButton}" Command="{Binding BrowseCommand}" ToolTip="Browse" Margin="0,0,4,0">
        <TextBlock Text="📁"/>
      </Button>
      <Button Style="{StaticResource IconFlatButton}" Command="{Binding OpenRemoteCommand}" ToolTip="Open remote" Margin="0,0,4,0">
        <TextBlock Text="🌐"/>
      </Button>
      <Button Style="{StaticResource IconFlatButton}" Command="{Binding OpenPipelinesCommand}" ToolTip="Pipelines" Margin="0,0,4,0">
        <TextBlock Text="🛳️"/>
      </Button>
      <Button Style="{StaticResource IconFlatButton}" Command="{Binding OpenGitUiCommand}" ToolTip="Git UI" Margin="0,0,4,0">
        <TextBlock Text="⌨️"/>
      </Button>
      <Button Style="{StaticResource IconFlatButton}" Command="{Binding CopyNameCommand}" ToolTip="Copy name" Margin="0,0,4,0">
        <TextBlock Text="⎘"/>
      </Button>
      <Button Style="{StaticResource IconFlatButton}" Command="{Binding CopyPathCommand}" ToolTip="Copy path" Margin="0,0,4,0">
        <TextBlock Text="📋"/>
      </Button>
    </UniformGrid>


    <!-- Context menu -->
    <Grid.ContextMenu>
      <ContextMenu DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
        <MenuItem Header="Launch" Command="{Binding LaunchCommand}"/>
        <MenuItem Header="Browse" Command="{Binding BrowseCommand}"/>
        <Separator/>
        <MenuItem Header="Open Remote" Command="{Binding OpenRemoteCommand}"/>
        <MenuItem Header="Open Pipelines" Command="{Binding OpenPipelinesCommand}"/>
        <MenuItem Header="Git UI" Command="{Binding OpenGitUiCommand}"/>
        <Separator/>
        <MenuItem Header="Copy Name" Command="{Binding CopyNameCommand}"/>
        <MenuItem Header="Copy Path" Command="{Binding CopyPathCommand}"/>
      </ContextMenu>
    </Grid.ContextMenu>
  </Grid>
</UserControl>
